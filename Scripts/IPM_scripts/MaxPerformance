#procedura per l'ottimizzazione
proc MaxTimeConstrain {Module fileDescriptor} {
	puts $fileDescriptor [subst "\n\n#Puts max_delay constrain in $Module"]
	#usando i doppi apici non mi funziona l'escape del carattere
	#se non si dichiarano gli endpoint con get_pins ma con get_cells prende quelli sbagliati e questo porta a path segmentation-> alcuni vincoli vengono eliminati
	#ClosureTimings
	puts $fileDescriptor [subst {set_max_delay -from \[get_pins $Module/input_pipe/req_latch/Q\] -to \[get_pins $Module/input_pipe/*.Data_latch/GE\] 0.000}]
	puts $fileDescriptor [subst {set_max_delay -from \[get_pins $Module/input_pipe/req_latch/Q\] -to \[get_pins $Module/input_pipe/req_latch/GE\] 0.000}]
	#Data->amd
	puts $fileDescriptor [subst {set_max_delay -from \[get_pins $Module/input_pipe/*.Data_latch/Q\] -to \[get_pins $Module/PRC/*.RouteAnd/I1\] 0.000}]
	#req->and
	puts $fileDescriptor [subst {set_max_delay -from \[get_pins $Module/input_pipe/req_latch/Q\] -to \[get_pins $Module/PRC/*.RouteAnd/I0\] 0.000}]
	puts $fileDescriptor "\n\n"
}

#---------------MAIN----------------#
#Global variables
	set InportPortModule "ipm"

#---------Ottimizzazione
	open_run synth_1 -name synth_1
	#---------Preparazione Constraint File
	set InportModules [get_cells -hierarchical -filter [subst {ORIG_REF_NAME== $InportPortModule || REF_NAME== $InportPortModule}]]
	set f [open Temp.xdc w+] 
	foreach Module $InportModules {
				MaxTimeConstrain $Module $f
	}
	close $f
	exec mv Temp.xdc ./Sources/Constraints/BundledConstraints.xdc
